<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyChat - 多語伴侶</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
        
        .fade-in-up {
            animation: fadeInUp 0.3s ease-out forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900 h-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="bg-white px-4 py-3 shadow-sm flex items-center justify-between z-20 shrink-0">
        <div class="flex items-center space-x-3">
            <div id="avatar-container" class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-md transition-colors duration-300">
                <!-- Avatar Initial -->
            </div>
            <div>
                <h1 class="font-bold text-lg leading-tight flex items-center gap-1">
                    <span id="bot-name">Bot</span>
                    <span class="w-2 h-2 bg-green-500 rounded-full ml-1 animate-pulse"></span>
                </h1>
                <p id="lang-name" class="text-xs text-gray-500 flex items-center gap-1">
                    Language
                </p>
            </div>
        </div>
        
        <div class="flex items-center space-x-2 relative">
            <button onclick="startNewConversation()" class="p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors" title="New Topic">
                <i data-lucide="refresh-ccw" class="w-5 h-5"></i>
            </button>
            <button onclick="toggleLangMenu()" class="p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors" id="lang-btn">
                <i data-lucide="globe" class="w-5 h-5"></i>
            </button>

            <!-- Language Menu -->
            <div id="lang-menu" class="hidden absolute top-12 right-0 bg-white rounded-xl shadow-xl border border-gray-100 w-56 overflow-hidden z-30 transform origin-top-right transition-all">
                <div class="p-3 bg-gray-50 border-b border-gray-100 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    Select Language
                </div>
                <div id="lang-list" class="max-h-[300px] overflow-y-auto">
                    <!-- Language items generated by JS -->
                </div>
            </div>
        </div>
    </header>

    <!-- Chat Area -->
    <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-[#f0f2f5] scroll-smooth">
        <div class="flex justify-center my-2">
            <span class="text-xs text-gray-400 bg-gray-200 px-3 py-1 rounded-full">Today</span>
        </div>
        <!-- Messages will be injected here -->
        <div id="messages-list" class="space-y-4 pb-2"></div>
        
        <!-- Typing Indicator -->
        <div id="typing-indicator" class="hidden flex justify-start w-full fade-in-up">
            <div class="flex items-end gap-2">
                <div id="typing-avatar" class="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold"></div>
                <div class="bg-white border border-gray-100 px-4 py-3 rounded-2xl rounded-bl-none shadow-sm flex space-x-1 items-center h-10">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                </div>
            </div>
        </div>
        <div id="scroll-anchor"></div>
    </main>

    <!-- Input Area -->
    <footer class="bg-white border-t border-gray-100 p-3 pb-safe z-20 shrink-0">
        <form id="chat-form" class="flex items-center gap-2 max-w-4xl mx-auto">
            <button type="button" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors hidden sm:block">
                <i data-lucide="more-horizontal" class="w-6 h-6"></i>
            </button>
            
            <div class="flex-1 relative">
                <input 
                    type="text" 
                    id="message-input" 
                    placeholder="Type a message..." 
                    class="w-full bg-gray-100 text-gray-800 placeholder-gray-500 border-0 rounded-full py-3 px-5 pr-10 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-inner outline-none"
                    autocomplete="off"
                >
                <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                    <i data-lucide="smile" class="w-5 h-5"></i>
                </button>
            </div>

            <button id="send-btn" type="submit" class="p-3 bg-gray-200 text-gray-500 rounded-full transition-all duration-200 shadow-md transform active:scale-95 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500">
                <i data-lucide="mic" class="w-5 h-5" id="send-icon"></i>
            </button>
        </form>
    </footer>

    <script>
        // --- Data Configuration ---
        const LANGUAGE_CONFIG = {
            en: {
                name: "English",
                botName: "Alex",
                avatarColor: "bg-blue-500",
                placeholders: "Type a message...",
                greetings: [
                    { text: "Hey! Long time no see. How have you been?", trans: "嘿！好久不見。你最近好嗎？" },
                    { text: "I just saw the craziest movie. Do you like sci-fi?", trans: "我剛看了一部超瘋狂的電影。你喜歡科幻片嗎？" },
                    { text: "It's raining so hard here! How's the weather on your side?", trans: "這裡雨下得好大！你那邊天氣如何？" },
                    { text: "Quick question: Coffee or Tea? I can't decide.", trans: "快問快答：咖啡還是茶？我決定不了。" }
                ],
                responses: [
                    { text: "That's really interesting! Tell me more.", trans: "真有趣！多跟我說一點。" },
                    { text: "Haha, I totally agree with you.", trans: "哈哈，我完全同意你。" },
                    { text: "No way! Are you serious?", trans: "不會吧！你是認真的嗎？" },
                    { text: "That's a good point.", trans: "這觀點不錯。" }
                ]
            },
            jp: {
                name: "日本語 (Japanese)",
                botName: "Haruto",
                avatarColor: "bg-red-500",
                placeholders: "メッセージを入力...",
                greetings: [
                    { text: "やっほー！久しぶり。元気だった？", trans: "耶！好久不見。你好嗎？" },
                    { text: "ねえ、今週末何か予定ある？", trans: "吶，這週末有什麼計畫嗎？" },
                    { text: "最近、新しいアニメ見始めたんだけど、おすすめある？", trans: "最近開始看一部新動畫，有什麼推薦的嗎？" }
                ],
                responses: [
                    { text: "へえー、そうなんだ！", trans: "欸—，是這樣啊！" },
                    { text: "それは面白いね！", trans: "那很有趣呢！" },
                    { text: "マジで！？信じられない！", trans: "真的假的！？真不敢相信！" }
                ]
            },
            kr: {
                name: "한국어 (Korean)",
                botName: "Ji-min",
                avatarColor: "bg-purple-500",
                placeholders: "메시지를 입력하세요...",
                greetings: [
                    { text: "안녕! 잘 지냈어? 보고 싶었어!", trans: "你好！過得好嗎？好想你喔！" },
                    { text: "오늘 날씨 진짜 춥지 않아?", trans: "今天天氣真的很冷對吧？" },
                    { text: "나 지금 치킨 먹고 싶은데, 같이 먹을래?", trans: "我現在好想吃炸雞，要一起吃嗎？" }
                ],
                responses: [
                    { text: "진짜? 대박이다!", trans: "真的嗎？太厲害了！" },
                    { text: "완전 공감해 ㅋㅋ", trans: "完全有同感 哈哈" }
                ]
            },
            fr: {
                name: "Français (French)",
                botName: "Camille",
                avatarColor: "bg-indigo-500",
                placeholders: "Écrivez un message...",
                greetings: [
                    { text: "Salut ! Comment ça va aujourd'hui ?", trans: "嗨！今天過得如何？" },
                    { text: "J'ai découvert un café génial ce matin.", trans: "我今早發現一家很棒的咖啡廳。" }
                ],
                responses: [
                    { text: "C'est génial !", trans: "太棒了！" },
                    { text: "Ah bon ? Je ne savais pas.", trans: "是喔？我不知道耶。" }
                ]
            },
            es: {
                name: "Español (Spanish)",
                botName: "Sofia",
                avatarColor: "bg-yellow-500",
                placeholders: "Escribe un mensaje...",
                greetings: [
                    { text: "¡Hola! ¿Qué tal todo?", trans: "嗨！一切都好嗎？" },
                    { text: "Oye, ¿te gusta bailar salsa?", trans: "嘿，你喜歡跳莎莎舞嗎？" }
                ],
                responses: [
                    { text: "¡Qué guay!", trans: "太酷了！" },
                    { text: "Totalmente de acuerdo.", trans: "完全同意。" }
                ]
            }
        };

        // --- State ---
        let currentLang = 'en';
        let isTyping = false;

        // --- DOM Elements ---
        const els = {
            avatarContainer: document.getElementById('avatar-container'),
            botName: document.getElementById('bot-name'),
            langName: document.getElementById('lang-name'),
            messageInput: document.getElementById('message-input'),
            messagesList: document.getElementById('messages-list'),
            chatForm: document.getElementById('chat-form'),
            sendBtn: document.getElementById('send-btn'),
            sendIcon: document.getElementById('send-icon'),
            typingIndicator: document.getElementById('typing-indicator'),
            typingAvatar: document.getElementById('typing-avatar'),
            scrollAnchor: document.getElementById('scroll-anchor'),
            langMenu: document.getElementById('lang-menu'),
            langList: document.getElementById('lang-list')
        };

        // --- Initialization ---
        function init() {
            renderLangList();
            updateHeader();
            startNewConversation();
            
            // Input Listener to toggle Send/Mic icon
            els.messageInput.addEventListener('input', (e) => {
                const hasText = e.target.value.trim().length > 0;
                if (hasText) {
                    els.sendBtn.classList.remove('bg-gray-200', 'text-gray-500');
                    els.sendBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    els.sendIcon.setAttribute('data-lucide', 'send');
                } else {
                    els.sendBtn.classList.add('bg-gray-200', 'text-gray-500');
                    els.sendBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    els.sendIcon.setAttribute('data-lucide', 'mic');
                }
                lucide.createIcons();
            });

            lucide.createIcons();
        }

        // --- Core Logic ---

        function updateHeader() {
            const config = LANGUAGE_CONFIG[currentLang];
            
            // Remove old color classes
            els.avatarContainer.className = `w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-md transition-colors duration-300 ${config.avatarColor}`;
            els.avatarContainer.textContent = config.botName[0];
            els.botName.textContent = config.botName;
            els.langName.textContent = `${config.name} Speaker`;
            els.messageInput.placeholder = config.placeholders;
            
            // Update typing avatar color too
            els.typingAvatar.className = `w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold ${config.avatarColor}`;
            els.typingAvatar.textContent = config.botName[0];
        }

        function scrollToBottom() {
            els.scrollAnchor.scrollIntoView({ behavior: "smooth" });
        }

        function showTyping() {
            isTyping = true;
            els.typingIndicator.classList.remove('hidden');
            scrollToBottom();
        }

        function hideTyping() {
            isTyping = false;
            els.typingIndicator.classList.add('hidden');
        }

        function createMessageElement(text, translation, sender, timestamp) {
            const config = LANGUAGE_CONFIG[currentLang];
            const isUser = sender === 'user';
            
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = `flex w-full ${isUser ? 'justify-end' : 'justify-start'} fade-in-up`;
            
            const innerDiv = document.createElement('div');
            innerDiv.className = `flex max-w-[85%] ${isUser ? 'flex-row-reverse' : 'flex-row'} items-end gap-2`;
            
            // Avatar (only for bot)
            if (!isUser) {
                const avatar = document.createElement('div');
                avatar.className = `w-8 h-8 rounded-full ${config.avatarColor} flex-shrink-0 flex items-center justify-center text-white text-xs font-bold shadow-sm`;
                avatar.textContent = config.botName[0];
                innerDiv.appendChild(avatar);
            }

            // Message Bubble Container
            const bubbleContainer = document.createElement('div');
            bubbleContainer.className = "flex flex-col items-start gap-1";

            const bubble = document.createElement('div');
            bubble.className = `px-4 py-2.5 rounded-2xl shadow-sm text-[15px] leading-relaxed relative group transition-all duration-200 
                ${isUser ? 'bg-blue-600 text-white rounded-br-none' : 'bg-white text-gray-800 rounded-bl-none border border-gray-100'}`;
            
            // Text Content
            const textDiv = document.createElement('div');
            textDiv.className = "mb-1";
            textDiv.textContent = text;
            bubble.appendChild(textDiv);

            // Translation (Hidden by default)
            let transDiv = null;
            if (translation) {
                transDiv = document.createElement('div');
                transDiv.className = `hidden mt-2 pt-2 border-t text-sm font-medium animate-in fade-in slide-in-from-top-1 
                    ${isUser ? 'border-blue-400 text-blue-100' : 'border-gray-100 text-gray-600'}`;
                transDiv.textContent = translation;
                bubble.appendChild(transDiv);
            }

            // Timestamp
            const timeDiv = document.createElement('div');
            timeDiv.className = `text-[10px] mt-1 opacity-70 flex justify-end items-center gap-1 ${isUser ? 'text-blue-100' : 'text-gray-400'}`;
            timeDiv.textContent = timestamp;
            bubble.appendChild(timeDiv);

            bubbleContainer.appendChild(bubble);

            // Translation Toggle Button (Only for Bot)
            if (!isUser && translation) {
                const transBtn = document.createElement('button');
                transBtn.className = "text-xs flex items-center gap-1 px-2 py-1 rounded-full transition-colors ml-1 bg-gray-200 text-gray-500 hover:bg-gray-300 mt-1";
                transBtn.innerHTML = `<i data-lucide="languages" class="w-3 h-3"></i> <span>翻譯</span>`;
                
                transBtn.onclick = () => {
                    const isHidden = transDiv.classList.contains('hidden');
                    if (isHidden) {
                        transDiv.classList.remove('hidden');
                        transBtn.classList.remove('bg-gray-200', 'text-gray-500');
                        transBtn.classList.add('bg-blue-100', 'text-blue-600');
                        transBtn.querySelector('span').textContent = "隱藏翻譯";
                    } else {
                        transDiv.classList.add('hidden');
                        transBtn.classList.add('bg-gray-200', 'text-gray-500');
                        transBtn.classList.remove('bg-blue-100', 'text-blue-600');
                        transBtn.querySelector('span').textContent = "翻譯";
                    }
                };
                bubbleContainer.appendChild(transBtn);
            }

            innerDiv.appendChild(bubbleContainer);
            wrapperDiv.appendChild(innerDiv);
            
            return wrapperDiv;
        }

        function appendMessage(text, translation, sender) {
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const msgEl = createMessageElement(text, translation, sender, timestamp);
            els.messagesList.appendChild(msgEl);
            lucide.createIcons(); // Refresh icons for new elements
            scrollToBottom();
        }

        function startNewConversation() {
            els.messagesList.innerHTML = ''; // Clear chat
            showTyping();
            
            setTimeout(() => {
                const config = LANGUAGE_CONFIG[currentLang];
                const randomGreeting = config.greetings[Math.floor(Math.random() * config.greetings.length)];
                
                hideTyping();
                appendMessage(randomGreeting.text, randomGreeting.trans, 'bot');
            }, 1500);
        }

        // --- Event Handlers ---

        els.chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = els.messageInput.value.trim();
            if (!text) return;

            // 1. Add User Message
            appendMessage(text, null, 'user');
            els.messageInput.value = '';
            
            // Reset button style
            els.sendBtn.classList.add('bg-gray-200', 'text-gray-500');
            els.sendBtn.classList.remove('bg-blue-600', 'text-white');
            els.sendIcon.setAttribute('data-lucide', 'mic');
            lucide.createIcons();

            // 2. Simulate Bot Response
            showTyping();
            setTimeout(() => {
                const config = LANGUAGE_CONFIG[currentLang];
                const randomResponse = config.responses[Math.floor(Math.random() * config.responses.length)];
                
                hideTyping();
                appendMessage(randomResponse.text, randomResponse.trans, 'bot');
            }, 2000 + Math.random() * 1000);
        });

        // --- Language Menu Logic ---
        
        function toggleLangMenu() {
            els.langMenu.classList.toggle('hidden');
        }

        function switchLanguage(lang) {
            if (currentLang === lang) {
                toggleLangMenu();
                return;
            }
            currentLang = lang;
            toggleLangMenu();
            renderLangList(); // Re-render to update active state
            updateHeader();
            startNewConversation();
        }

        function renderLangList() {
            els.langList.innerHTML = '';
            Object.keys(LANGUAGE_CONFIG).forEach(key => {
                const config = LANGUAGE_CONFIG[key];
                const isActive = currentLang === key;
                
                const btn = document.createElement('button');
                btn.className = `w-full text-left px-4 py-3 text-sm flex items-center justify-between hover:bg-blue-50 transition-colors ${isActive ? 'bg-blue-50 text-blue-600 font-medium' : 'text-gray-700'}`;
                btn.onclick = () => switchLanguage(key);
                
                btn.innerHTML = `
                    <span>${config.name}</span>
                    ${isActive ? '<div class="w-2 h-2 rounded-full bg-blue-600"></div>' : ''}
                `;
                els.langList.appendChild(btn);
            });
        }

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const langBtn = document.getElementById('lang-btn');
            const langMenu = document.getElementById('lang-menu');
            if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
                langMenu.classList.add('hidden');
            }
        });

        // Start
        init();

    </script>
</body>
</html>